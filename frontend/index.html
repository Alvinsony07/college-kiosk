<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>College Kiosk Â· Login</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

    :root {
      --bg-gradient-start: #1e3a8a;
      --bg-gradient-end: #0f172a;
      --glass-bg: rgba(15, 23, 42, 0.55);
      --surface: rgba(255, 255, 255, 0.9);
      --primary-500: #2563eb;
      --primary-600: #1d4ed8;
      --accent-500: #38bdf8;
      --warning-500: #f97316;
      --success-500: #22c55e;
      --text-900: #0f172a;
      --text-100: #f8fafc;
      --muted-200: #cbd5f5;
      --muted-300: #94a3b8;
      --muted-700: #334155;
      --border-color: rgba(148, 163, 184, 0.25);
      --card-shadow: 0 24px 60px rgba(15, 23, 42, 0.35);
      --glow: 0 0 80px rgba(37, 99, 235, 0.45);
      --transition-base: 200ms ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', 'Segoe UI', sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      color: var(--text-100);
      position: relative;
      overflow-x: hidden;
    }

    body::before,
    body::after {
      content: "";
      position: fixed;
      inset: auto -20% -40% 50%;
      width: 520px;
      height: 520px;
      background: radial-gradient(circle at center, rgba(56, 189, 248, 0.35), transparent 65%);
      filter: blur(70px);
      opacity: 0.8;
      pointer-events: none;
      transform: translate(-50%, 0);
    }

    body::after {
      inset: -30% 45% auto auto;
      background: radial-gradient(circle at center, rgba(37, 99, 235, 0.38), transparent 70%);
      transform: translate(0, 0);
    }

    .page-wrapper {
      width: min(520px, 94vw);
      margin: auto;
      padding: clamp(2rem, 5vw, 3.5rem) clamp(1.5rem, 4vw, 3rem);
      display: flex;
      justify-content: center;
      position: relative;
      z-index: 1;
    }

    .form-panel {
      width: 100%;
      display: flex;
      justify-content: center;
    }

    .glass-card {
      width: min(480px, 100%);
      margin-left: auto;
      padding: clamp(2rem, 4vw, 2.75rem);
      border-radius: 32px;
      background: var(--surface);
      color: var(--text-900);
      box-shadow: var(--card-shadow);
      position: relative;
      overflow: hidden;
    }

    .glass-card::before {
      content: "";
      position: absolute;
      inset: -45% 30% auto -35%;
      height: 420px;
      background: radial-gradient(circle at top, rgba(37, 99, 235, 0.16), transparent 65%);
      pointer-events: none;
    }

    .glass-card::after {
      content: "";
      position: absolute;
      inset: auto -25% -45% 55%;
      width: 360px;
      height: 360px;
      background: radial-gradient(circle at center, rgba(56, 189, 248, 0.18), transparent 70%);
      pointer-events: none;
    }

    .card-content {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      gap: 1.75rem;
    }

    .card-header h2 {
      font-size: clamp(1.85rem, 3vw, 2.25rem);
      font-weight: 600;
      margin-bottom: 0.35rem;
      color: var(--text-900);
    }

    .card-header p {
      color: var(--muted-700);
      line-height: 1.6;
    }

    form {
      display: grid;
      gap: 1.25rem;
    }

    .input-group {
      display: grid;
      gap: 0.5rem;
    }

    label {
      font-weight: 500;
      color: var(--muted-700);
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
    }

    .input-wrapper {
      position: relative;
      border-radius: 16px;
      border: 1px solid rgba(15, 23, 42, 0.08);
      background: rgba(248, 250, 252, 0.85);
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.55);
      transition: box-shadow var(--transition-base), transform var(--transition-base);
      display: flex;
      align-items: center;
      overflow: hidden;
    }

    .input-wrapper:focus-within {
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15), inset 0 0 0 1px rgba(37, 99, 235, 0.45);
      transform: translateY(-2px);
    }

    input[type="email"],
    input[type="password"] {
      width: 100%;
      border: none;
      background: transparent;
      padding: 0.95rem 1.15rem;
      font-size: 1rem;
      color: var(--text-900);
      font-family: inherit;
      outline: none;
    }

    .toggle-password {
      position: absolute;
      right: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      border: none;
      background: none;
      cursor: pointer;
      color: var(--muted-700);
      display: grid;
      place-items: center;
      width: 36px;
      height: 36px;
      border-radius: 12px;
      transition: background var(--transition-base), color var(--transition-base);
    }

    .toggle-password:hover {
      background: rgba(37, 99, 235, 0.08);
      color: var(--primary-600);
    }

    .toggle-password svg {
      width: 20px;
      height: 20px;
    }

    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .remember {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 0.9rem;
      color: var(--muted-700);
    }

    .remember input {
      width: 16px;
      height: 16px;
      accent-color: var(--primary-500);
    }

    .link-inline {
      font-size: 0.9rem;
      color: var(--primary-600);
      text-decoration: none;
      font-weight: 500;
    }

    .primary-btn {
      width: 100%;
      padding: 0.95rem 1.25rem;
      border-radius: 18px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 0.75rem;
      background: linear-gradient(140deg, var(--primary-500), #4338ca 70%);
      color: white;
      font-size: 1.05rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      box-shadow: 0 18px 35px rgba(37, 99, 235, 0.35);
      transition: transform 220ms ease, box-shadow 220ms ease;
      position: relative;
      overflow: hidden;
    }

    .primary-btn::before {
      content: "";
      position: absolute;
      inset: -150%;
      background: radial-gradient(circle at center, rgba(255, 255, 255, 0.25), transparent 70%);
      transform: translateX(-60%);
      transition: transform 420ms ease;
    }

    .primary-btn:hover {
      transform: translateY(-3px) scale(1.01);
      box-shadow: 0 22px 42px rgba(37, 99, 235, 0.45);
    }

    .primary-btn:hover::before {
      transform: translateX(40%);
    }

    .primary-btn:disabled {
      cursor: not-allowed;
      opacity: 0.75;
      transform: none;
      box-shadow: none;
    }

    .btn-spinner {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.65);
      border-right-color: transparent;
      display: none;
      animation: spin 650ms linear infinite;
    }

    .primary-btn.is-loading .btn-spinner {
      display: inline-block;
    }

    .primary-btn.is-loading .btn-text {
      opacity: 0.4;
    }

    .message {
      text-align: center;
      padding: 0.85rem;
      border-radius: 14px;
      font-size: 0.95rem;
      font-weight: 500;
      display: none;
      line-height: 1.5;
    }

    .message.is-visible {
      display: block;
    }

    .message--error {
      background: rgba(220, 38, 38, 0.12);
      color: #b91c1c;
      border: 1px solid rgba(248, 113, 113, 0.45);
    }

    .message--success {
      background: rgba(34, 197, 94, 0.12);
      color: var(--success-500);
      border: 1px solid rgba(34, 197, 94, 0.35);
    }

    .register-link {
      text-align: center;
      font-size: 0.95rem;
      color: var(--muted-700);
    }

    .register-link a {
      color: var(--primary-600);
      font-weight: 600;
      text-decoration: none;
      position: relative;
    }

    .register-link a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -3px;
      width: 100%;
      height: 2px;
      background: linear-gradient(120deg, var(--primary-500), var(--accent-500));
      transform: scaleX(0);
      transform-origin: right;
      transition: transform 200ms ease;
    }

    .register-link a:hover::after {
      transform: scaleX(1);
      transform-origin: left;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (max-width: 980px) {
      .page-wrapper {
        width: min(540px, 92vw);
      }
    }

    @media (max-width: 640px) {
      body {
        padding: 1.5rem 0;
      }
      .glass-card {
        box-shadow: 0 20px 45px rgba(15, 23, 42, 0.4);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <section class="form-panel">
      <div class="glass-card">
        <div class="card-content">
          <header class="card-header">
            <h2>Welcome back</h2>
            <p>Sign in with your <strong>college email</strong> to access your personalised dashboard.</p>
          </header>

          <form id="loginForm" novalidate>
            <div class="input-group">
              <label for="email">College email</label>
              <div class="input-wrapper">
                <input type="email" id="email" name="email" placeholder="admin@college.edu" autocomplete="email" required />
              </div>
            </div>

            <div class="input-group">
              <label for="password">Password</label>
              <div class="input-wrapper">
                <input type="password" id="password" name="password" placeholder="Enter your password" autocomplete="current-password" required />
                <button type="button" class="toggle-password" id="togglePassword" aria-label="Toggle password visibility" aria-pressed="false">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M1.5 12s3.5-7 10.5-7 10.5 7 10.5 7-3.5 7-10.5 7S1.5 12 1.5 12z" />
                    <circle cx="12" cy="12" r="3.2" />
                  </svg>
                </button>
              </div>
            </div>

            <div class="actions">
              <label class="remember">
                <input type="checkbox" id="rememberMe" />
                Keep me signed in
              </label>
              <a class="link-inline" href="#" onclick="event.preventDefault(); alert('Please contact the admin team to reset your password.');">Forgot password?</a>
            </div>

            <button type="submit" class="primary-btn" id="loginButton">
              <span class="btn-text">Sign in</span>
              <span class="btn-spinner"></span>
            </button>
          </form>

          <div class="message" id="msg" role="status" aria-live="polite"></div>

          <div class="register-link">
            Don't have an account yet? <a href="/register">Register here</a>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    const loginForm = document.getElementById('loginForm');
    const messageEl = document.getElementById('msg');
    const loginButton = document.getElementById('loginButton');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const togglePasswordBtn = document.getElementById('togglePassword');

    const setMessage = (text, type = 'error') => {
      messageEl.textContent = text;
      messageEl.classList.remove('message--error', 'message--success', 'is-visible');
      if (!text) return;
      messageEl.classList.add(type === 'success' ? 'message--success' : 'message--error', 'is-visible');
    };

    const setLoading = (isLoading) => {
      loginButton.disabled = isLoading;
      loginButton.classList.toggle('is-loading', isLoading);
    };

    togglePasswordBtn.addEventListener('click', () => {
      const isHidden = passwordInput.type === 'password';
      passwordInput.type = isHidden ? 'text' : 'password';
      togglePasswordBtn.setAttribute('aria-pressed', String(isHidden));
      togglePasswordBtn.innerHTML = isHidden
        ? `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 19.5C5 19.5 1.5 12.5 1.5 12.5a18.41 18.41 0 0 1 5.05-6.62"/><path d="M9.88 9.88a3.2 3.2 0 0 1 4.24 4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>`
        : `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M1.5 12s3.5-7 10.5-7 10.5 7 10.5 7-3.5 7-10.5 7S1.5 12 1.5 12z"/><circle cx="12" cy="12" r="3.2"/></svg>`;
      passwordInput.focus({ preventScroll: true });
    });

    [emailInput, passwordInput].forEach((input) =>
      input.addEventListener('input', () => {
        if (messageEl.classList.contains('is-visible')) {
          messageEl.classList.remove('is-visible');
        }
      })
    );

    loginForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();

      if (!email || !password) {
        setMessage('Please fill in both your email and password.');
        return;
      }

      if (!email.includes('@') || email.length < 5) {
        setMessage('Please enter a valid email address.');
        emailInput.focus();
        return;
      }

      setLoading(true);
      setMessage('');

      try {
        const res = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await res.json();
        if (res.ok) {
          // Store user data and token
          const userRole = data.user ? data.user.role : data.role;
          localStorage.setItem('userRole', userRole);
          localStorage.setItem('userName', data.user ? data.user.name : '');
          localStorage.setItem('userEmail', data.user ? data.user.email : '');
          localStorage.setItem('authToken', data.token || '');
          
          if (document.getElementById('rememberMe').checked) {
            localStorage.setItem('rememberedEmail', email);
          } else {
            localStorage.removeItem('rememberedEmail');
          }

          setMessage('Login successful! Redirectingâ¦', 'success');

          setTimeout(() => {
            if (userRole === 'admin') {
              window.location.href = '/admin';
            } else if (userRole === 'staff') {
              window.location.href = '/staff';
            } else if (userRole === 'user') {
              window.location.href = '/users';
            } else {
              setMessage('Unknown role returned. Please contact an administrator.');
            }
          }, 600);
        } else {
          setMessage(data.error || 'Invalid email or password.');
        }
      } catch (error) {
        setMessage('Unable to reach the server. Please try again shortly.');
      } finally {
        setLoading(false);
      }
    });

    (function restoreRememberedCredentials() {
      const rememberedEmail = localStorage.getItem('rememberedEmail');
      if (rememberedEmail) {
        emailInput.value = rememberedEmail;
        document.getElementById('rememberMe').checked = true;
      }
    })();
  </script>
</body>
</html>
